[supervisord]
nodaemon=true               ; Run in the foreground to keep the container alive
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:livekit]
command=/usr/local/bin/livekit-server --dev --udp-port 7882 --bind 0.0.0.0
directory=/app
priority=100                ; Start this first
startsecs=10                ; Wait 10s to assume it's stable
stdout_logfile=/var/log/livekit.log
stderr_logfile=/var/log/livekit.log
autorestart=true

[program:token-server]
; This command runs the server directly, as your .py file has app.run()
command=uv run python token_server.py
directory=/app
priority=200                ; Start after livekit
startsecs=5                 ; Wait 5s
stdout_logfile=/var/log/token-server.log
stderr_logfile=/var/log/token-server.log
autorestart=true

[program:agent]
command=uv run python agent.py start
directory=/app
priority=200                ; Start after livekit
startsecs=20                ; Give agent 20s to load models
stdout_logfile=/var/log/agent.log
stderr_logfile=/var/log/agent.log
autorestart=true

[program:react-app]
command=http-server -p 4173 -a 0.0.0.0 --silent
directory=/app/react-app/dist
priority=300                ; Start last
startsecs=5
stdout_logfile=/var/log/react-app.log
stderr_logfile=/var/log/react-app.log
autorestart=true